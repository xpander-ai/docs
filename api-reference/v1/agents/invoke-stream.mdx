---
title: "Invoke Agent (Stream)"
openapi: "POST /v1/agents/{agent_id}/invoke/stream"
description: "Invoke an AI agent with real-time streaming. Returns Server-Sent Events (SSE) for live task updates."
---

Execute an agent task with real-time streaming responses. This endpoint returns Server-Sent Events (SSE) that provide live updates as the agent processes the task. Perfect for interactive applications and real-time user interfaces.

## Path Parameters

<ParamField path="agent_id" type="string" required>
  Unique identifier of the agent to invoke (UUID format)
</ParamField>

## Request Body

<ParamField body="input" type="object" required>
  Agent execution input containing the task details
  <Expandable title="Input Object">
    <ParamField body="text" type="string">
      The message or task to send to the agent. Either `text` or `files` must be provided.
    </ParamField>
    <ParamField body="files" type="array">
      Array of file URLs or file identifiers to process. Supports documents (PDF, DOCX, TXT), images (JPG, PNG), spreadsheets (CSV, XLSX), and more.
      
      **Example**: `["https://example.com/doc.pdf", "file-id-12345"]`
    </ParamField>
    <ParamField body="user" type="object">
      User information for personalization and audit trail
      <Expandable title="User Object">
        <ParamField body="id" type="string">
          Unique user identifier
        </ParamField>
        <ParamField body="first_name" type="string">
          User's first name
        </ParamField>
        <ParamField body="last_name" type="string">
          User's last name
        </ParamField>
        <ParamField body="email" type="string" required>
          User's email address (required if user object is provided)
        </ParamField>
        <ParamField body="additional_attributes" type="object">
          Custom user metadata (e.g., `{"customer_tier": "premium", "preferences": {...}}`)
        </ParamField>
      </Expandable>
    </ParamField>
  </Expandable>
</ParamField>

<ParamField body="output_format" type="string">
  Desired output format. Valid values: `text` | `json` | `markdown`
  
  **Default**: `text`
  
  - `text`: Plain text response
  - `json`: Structured JSON output (use with `output_schema` for validation)
  - `markdown`: Formatted markdown response
</ParamField>

<ParamField body="output_schema" type="object">
  JSON Schema to validate and structure the agent's output. When provided with `output_format: "json"`, the agent will return data conforming to this schema.
  
  **Example**:
  ```json
  {
    "type": "object",
    "required": ["summary", "insights"],
    "properties": {
      "summary": {"type": "string"},
      "insights": {"type": "array", "items": {"type": "string"}}
    }
  }
  ```
</ParamField>

<ParamField body="events_streaming" type="boolean">
  Enable detailed event streaming for granular progress tracking. When `true`, emits events for tool calls, intermediate steps, and execution progress.
  
  **Default**: `false`
  
  **Recommended**: Set to `true` for this endpoint to get maximum visibility into agent execution.
</ParamField>

<ParamField body="additional_context" type="string">
  Additional context to guide the agent's behavior. Use this to specify tone, audience, constraints, or background information.
  
  **Example**: `"This is for executive leadership. Use professional tone and focus on business impact."`
</ParamField>

<ParamField body="expected_output" type="string">
  Description of the expected output format, length, or structure. Helps guide the agent to produce the desired result.
  
  **Example**: `"A 500-word summary with 3 key recommendations and supporting data."`
</ParamField>

<ParamField body="title" type="string">
  Human-readable title for the task. Useful for identification and organization in task lists.
  
  **Example**: `"Real-time Data Analysis"`
</ParamField>

<ParamField body="parent_execution_id" type="string">
  UUID of the parent task if this is a sub-task. Used for multi-agent workflows and task hierarchies.
  
  **Example**: `"550e8400-e29b-41d4-a716-446655440000"`
</ParamField>

<ParamField body="triggering_agent_id" type="string">
  UUID of the agent that triggered this task. Used for tracking agent-to-agent delegation.
  
  **Example**: `"7c9e6679-7425-40de-944b-e07fc1f90ae7"`
</ParamField>

<ParamField body="payload_extension" type="object">
  Custom metadata to attach to the task. Any valid JSON object. Useful for tracking, routing, or application-specific data.
  
  **Example**:
  ```json
  {
    "request_id": "REQ-2025-001",
    "priority": "high",
    "stream_session_id": "stream-789"
  }
  ```
</ParamField>

<ParamField body="mcp_servers" type="array">
  Array of Model Context Protocol (MCP) server configurations to use during execution. Enables integration with external tools and services.
  
  **Example**:
  ```json
  [
    {
      "name": "real-time-data",
      "config": {"refresh_interval": 5}
    }
  ]
  ```
</ParamField>

<ParamField body="source" type="string">
  Identifier for the source system or application that created this task. Useful for analytics and debugging.
  
  **Example**: `"chat-widget"` | `"mobile-app"` | `"websocket-client"`
</ParamField>

<ParamField body="id" type="string">
  **Thread ID** for conversation context. This ID is critical for multi-turn conversations:
  
  - **If not provided**: A UUID will be automatically generated (recommended for single-turn requests)
  - **First message in conversation**: Provide a unique UUID and save it for subsequent messages
  - **Follow-up messages**: Use the same `id` from the first request to maintain conversation history
  - The agent will remember all previous messages in the thread when you reuse the same ID
  
  **Example**: `"a37db9a1-e483-4544-9136-b32120ae8c81"`
  
  <Info>
    **Multi-Turn Conversations**: To enable the agent to remember previous messages, always use the same `id` for all requests in a conversation thread. Each unique `id` represents a separate conversation session. The response will include the same `id` (whether you provided it or it was auto-generated).
  </Info>
</ParamField>

## Example Requests

### Basic Streaming Request

```bash
curl -X POST -H "x-api-key: YOUR_API_KEY" \
     -H "Content-Type: application/json" \
     -d '{
       "input": {
         "text": "Write a story about AI"
       }
     }' \
     https://api.xpander.ai/v1/agents/{agent_id}/invoke/stream
```

### With Detailed Event Streaming

```bash
curl -X POST -H "x-api-key: YOUR_API_KEY" \
     -H "Content-Type: application/json" \
     -d '{
       "input": {
         "text": "Research AI trends and create a report"
       },
       "events_streaming": true,
       "title": "AI Trends Research"
     }' \
     https://api.xpander.ai/v1/agents/{agent_id}/invoke/stream
```

### File Processing with Progress Tracking

```bash
curl -X POST -H "x-api-key: YOUR_API_KEY" \
     -H "Content-Type: application/json" \
     -d '{
       "input": {
         "text": "Analyze these documents",
         "files": [
           "https://example.com/report1.pdf",
           "https://example.com/report2.pdf"
         ]
       },
       "events_streaming": true,
       "output_format": "markdown",
       "additional_context": "Focus on key metrics and trends"
     }' \
     https://api.xpander.ai/v1/agents/{agent_id}/invoke/stream
```

### Structured Output with Streaming

```bash
curl -X POST -H "x-api-key: YOUR_API_KEY" \
     -H "Content-Type: application/json" \
     -d '{
       "input": {
         "text": "Extract insights from customer feedback"
       },
       "output_format": "json",
       "output_schema": {
         "type": "object",
         "properties": {
           "sentiment": {"type": "string"},
           "themes": {"type": "array", "items": {"type": "string"}},
           "recommendations": {"type": "array", "items": {"type": "string"}}
         }
       },
       "events_streaming": true
     }' \
     https://api.xpander.ai/v1/agents/{agent_id}/invoke/stream
```

### Multi-Turn Conversation (Streaming)

```bash
# First message - creates a new conversation thread
curl -X POST -H "x-api-key: YOUR_API_KEY" \
     -H "Content-Type: application/json" \
     -d '{
       "input": {
         "text": "My favorite color is blue"
       },
       "id": "stream-thread-789",
       "events_streaming": true
     }' \
     https://api.xpander.ai/v1/agents/{agent_id}/invoke/stream

# Follow-up message in the same thread
curl -X POST -H "x-api-key: YOUR_API_KEY" \
     -H "Content-Type: application/json" \
     -d '{
       "input": {
         "text": "What is my favorite color?"
       },
       "id": "stream-thread-789",
       "events_streaming": true
     }' \
     https://api.xpander.ai/v1/agents/{agent_id}/invoke/stream
# Agent will stream response: "Your favorite color is blue"

# Another follow-up with conversation history
curl -X POST -H "x-api-key: YOUR_API_KEY" \
     -H "Content-Type: application/json" \
     -d '{
       "input": {
         "text": "How many messages have I sent in this thread?"
       },
       "id": "stream-thread-789",
       "events_streaming": true
     }' \
     https://api.xpander.ai/v1/agents/{agent_id}/invoke/stream
# Agent will respond based on complete conversation history
```

## Response Format

This endpoint returns Server-Sent Events (SSE) with `Content-Type: text/event-stream`

## Event Stream Format

Events are sent in SSE format:

```
data: {"type": "task_started", "task_id": "...", "timestamp": "..."}

data: {"type": "content_chunk", "content": "...", "is_final": false}

data: {"type": "task_completed", "task_id": "...", "result": "..."}
```

## Event Types

<ResponseField name="task_started" type="event">
  Sent when the task begins execution
  <Expandable title="Event Data">
    <ResponseField name="type" type="string">
      Event type: `task_started`
    </ResponseField>
    <ResponseField name="task_id" type="string">
      Unique identifier for the task (UUID)
    </ResponseField>
    <ResponseField name="timestamp" type="string">
      ISO 8601 timestamp of when the task started
    </ResponseField>
  </Expandable>
</ResponseField>

<ResponseField name="content_chunk" type="event">
  Sent for each piece of generated content
  <Expandable title="Event Data">
    <ResponseField name="type" type="string">
      Event type: `content_chunk`
    </ResponseField>
    <ResponseField name="content" type="string">
      Partial content from the agent
    </ResponseField>
    <ResponseField name="is_final" type="boolean">
      Whether this is the final content chunk
    </ResponseField>
  </Expandable>
</ResponseField>

<ResponseField name="task_completed" type="event">
  Sent when the task finishes successfully
  <Expandable title="Event Data">
    <ResponseField name="type" type="string">
      Event type: `task_completed`
    </ResponseField>
    <ResponseField name="task_id" type="string">
      Task identifier (UUID)
    </ResponseField>
    <ResponseField name="result" type="string">
      Complete task result content
    </ResponseField>
  </Expandable>
</ResponseField>

<ResponseField name="error" type="event">
  Sent if an error occurs during execution
  <Expandable title="Event Data">
    <ResponseField name="type" type="string">
      Event type: `error`
    </ResponseField>
    <ResponseField name="error" type="string">
      Error message
    </ResponseField>
  </Expandable>
</ResponseField>

## Example: JavaScript Client

```javascript
const response = await fetch('https://api.xpander.ai/v1/agents/{agent_id}/invoke/stream', {
  method: 'POST',
  headers: {
    'x-api-key': 'YOUR_API_KEY',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    input: {
      text: 'Analyze this data',
      files: []
    },
    events_streaming: true
  })
});

const reader = response.body.getReader();
const decoder = new TextDecoder();

while (true) {
  const { done, value } = await reader.read();
  if (done) break;
  
  const chunk = decoder.decode(value);
  const lines = chunk.split('\n');
  
  for (const line of lines) {
    if (line.startsWith('data: ')) {
      const event = JSON.parse(line.slice(6));
      console.log('Event:', event);
      
      if (event.type === 'task_completed') {
        console.log('Result:', event.result);
      }
    }
  }
}
```

## Notes

- The agent must have `deployment_type: serverless` or be a running container
- Connection stays open until task completes or errors
- Set appropriate timeout values for long-running tasks
- Handle connection errors and implement retry logic
- **Multi-Turn Conversations**: Use the same `id` parameter across requests to maintain conversation context. The agent will remember all previous messages in the thread and stream responses with full context awareness.

## See Also

- [Invoke Agent (Sync)](/API reference/v1/agents/invoke-sync) - For quick tasks with immediate results
- [Invoke Agent (Async)](/API reference/v1/agents/invoke-async) - For long-running tasks with polling
- [Get Task](/API reference/v1/tasks/get-task) - Retrieve task details after streaming completes
- [Get Task Thread](/API reference/v1/tasks/get-thread) - View complete conversation history for a thread
- [Agent Memory](/user-guide/build/agent-memory) - Configure how agents store and recall conversation history
