---
title: "Invoke Agent (Async)"
openapi: "POST /v1/agents/{agent_id}/invoke/async"
description: "Invoke an AI agent asynchronously. Returns immediately with task ID for later polling."
---

Execute an agent task asynchronously. This endpoint returns immediately with a task ID that can be used to poll for results. Best for long-running tasks or when you need non-blocking execution.

## Path Parameters

<ParamField path="agent_id" type="string" required>
  Unique identifier of the agent to invoke (UUID format)
</ParamField>

## Request Body

<ParamField body="input" type="object" required>
  Agent execution input containing the task details
  <Expandable title="Input Object">
    <ParamField body="text" type="string">
      The message or task to send to the agent. Either `text` or `files` must be provided.
    </ParamField>
    <ParamField body="files" type="array">
      Array of file URLs or file identifiers to process. Supports documents (PDF, DOCX, TXT), images (JPG, PNG), spreadsheets (CSV, XLSX), and more.
      
      **Example**: `["https://example.com/doc.pdf", "file-id-12345"]`
    </ParamField>
    <ParamField body="user" type="object">
      User information for personalization and audit trail
      <Expandable title="User Object">
        <ParamField body="id" type="string">
          Unique user identifier
        </ParamField>
        <ParamField body="first_name" type="string">
          User's first name
        </ParamField>
        <ParamField body="last_name" type="string">
          User's last name
        </ParamField>
        <ParamField body="email" type="string" required>
          User's email address (required if user object is provided)
        </ParamField>
        <ParamField body="additional_attributes" type="object">
          Custom user metadata (e.g., `{"customer_tier": "premium", "preferences": {...}}`)
        </ParamField>
      </Expandable>
    </ParamField>
  </Expandable>
</ParamField>

<ParamField body="output_format" type="string">
  Desired output format. Valid values: `text` | `json` | `markdown`
  
  **Default**: `text`
  
  - `text`: Plain text response
  - `json`: Structured JSON output (use with `output_schema` for validation)
  - `markdown`: Formatted markdown response
</ParamField>

<ParamField body="output_schema" type="object">
  JSON Schema to validate and structure the agent's output. When provided with `output_format: "json"`, the agent will return data conforming to this schema.
  
  **Example**:
  ```json
  {
    "type": "object",
    "required": ["name", "email"],
    "properties": {
      "name": {"type": "string"},
      "email": {"type": "string", "format": "email"}
    }
  }
  ```
</ParamField>

<ParamField body="additional_context" type="string">
  Additional context to guide the agent's behavior. Use this to specify tone, audience, constraints, or background information.
  
  **Example**: `"This is for executive leadership. Use professional tone and focus on business impact."`
</ParamField>

<ParamField body="expected_output" type="string">
  Description of the expected output format, length, or structure. Helps guide the agent to produce the desired result.
  
  **Example**: `"A 500-word summary with 3 key recommendations and supporting data."`
</ParamField>

<ParamField body="title" type="string">
  Human-readable title for the task. Useful for identification and organization in task lists.
  
  **Example**: `"Q4 Sales Analysis"`
</ParamField>

<ParamField body="parent_execution_id" type="string">
  UUID of the parent task if this is a sub-task. Used for multi-agent workflows and task hierarchies.
  
  **Example**: `"550e8400-e29b-41d4-a716-446655440000"`
</ParamField>

<ParamField body="triggering_agent_id" type="string">
  UUID of the agent that triggered this task. Used for tracking agent-to-agent delegation.
  
  **Example**: `"7c9e6679-7425-40de-944b-e07fc1f90ae7"`
</ParamField>

<ParamField body="payload_extension" type="object">
  Custom metadata to attach to the task. Any valid JSON object. Useful for tracking, routing, or application-specific data.
  
  **Example**:
  ```json
  {
    "request_id": "REQ-2025-001",
    "priority": "high",
    "department": "sales",
    "tags": ["urgent", "vip-customer"]
  }
  ```
</ParamField>

<ParamField body="events_streaming" type="boolean">
  Enable detailed event streaming for progress tracking. When `true`, provides granular events about tool calls and execution steps.
  
  **Default**: `false`
  
  **Note**: Only effective when using the `/invoke/stream` endpoint.
</ParamField>

<ParamField body="mcp_servers" type="array">
  Array of Model Context Protocol (MCP) server configurations to use during execution. Enables integration with external tools and services.
  
  **Example**:
  ```json
  [
    {
      "name": "web-search",
      "config": {"provider": "google", "max_results": 10}
    }
  ]
  ```
</ParamField>

<ParamField body="source" type="string">
  Identifier for the source system or application that created this task. Useful for analytics and debugging.
  
  **Example**: `"mobile-app"` | `"web-dashboard"` | `"api-integration"`
</ParamField>

<ParamField body="id" type="string">
  **Thread ID** for conversation context. This ID is critical for multi-turn conversations:
  
  - **If not provided**: A UUID will be automatically generated (recommended for single-turn requests)
  - **First message in conversation**: Provide a unique UUID and save it for subsequent messages
  - **Follow-up messages**: Use the same `id` from the first request to maintain conversation history
  - The agent will remember all previous messages in the thread when you reuse the same ID
  
  **Example**: `"a37db9a1-e483-4544-9136-b32120ae8c81"`
  
  <Info>
    **Multi-Turn Conversations**: To enable the agent to remember previous messages, always use the same `id` for all requests in a conversation thread. Each unique `id` represents a separate conversation session. The response will include the same `id` (whether you provided it or it was auto-generated).
  </Info>
</ParamField>

<ParamField body="worker_id" type="string">
  Identifier for the worker or process handling this task. Used for distributed execution tracking.
</ParamField>

<ParamField body="run_locally" type="boolean">
  Execute the task locally instead of in the cloud. Used for development and testing.
  
  **Default**: `false`
</ParamField>

## Response

Returns a complete `AgentExecution` object:

<ResponseField name="id" type="string">
  Unique identifier for the created task (UUID) - use this to poll for results
</ResponseField>

<ResponseField name="agent_id" type="string">
  UUID of the agent executing this task
</ResponseField>

<ResponseField name="organization_id" type="string">
  UUID of the organization
</ResponseField>

<ResponseField name="status" type="string">
  Initial task status: `pending`, `executing`, `completed`, `failed`
</ResponseField>

<ResponseField name="input" type="object">
  The input object that was provided
</ResponseField>

<ResponseField name="created_at" type="string">
  ISO 8601 timestamp of when the task was created
</ResponseField>

<ResponseField name="result" type="string">
  Task result (null until completed)
</ResponseField>

<ResponseField name="output_format" type="string">
  The output format specified
</ResponseField>

<ResponseField name="output_schema" type="object">
  The output schema if provided
</ResponseField>

## Example Requests

### Basic Request

```bash
curl -X POST -H "x-api-key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "input": {
      "text": "What is the weather in San Francisco?"
    }
  }' \
  https://api.xpander.ai/v1/agents/{agent_id}/invoke/async
```

### Structured JSON Output

```bash
curl -X POST -H "x-api-key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "input": {
      "text": "Extract contact info: John Doe, john@example.com, (555) 123-4567"
    },
    "output_format": "json",
    "output_schema": {
      "type": "object",
      "required": ["name", "email", "phone"],
      "properties": {
        "name": {"type": "string"},
        "email": {"type": "string", "format": "email"},
        "phone": {"type": "string"}
      }
    }
  }' \
  https://api.xpander.ai/v1/agents/{agent_id}/invoke/async
```

### File Processing with User Context

```bash
curl -X POST -H "x-api-key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "input": {
      "text": "Analyze these documents and summarize key findings",
      "files": [
        "https://example.com/report.pdf",
        "https://example.com/data.csv"
      ],
      "user": {
        "id": "user-123",
        "first_name": "Jane",
        "last_name": "Smith",
        "email": "jane.smith@company.com",
        "additional_attributes": {
          "department": "analytics",
          "role": "senior_analyst"
        }
      }
    },
    "title": "Q4 Report Analysis",
    "additional_context": "Focus on year-over-year trends and regional performance",
    "expected_output": "Executive summary with 3-5 key insights"
  }' \
  https://api.xpander.ai/v1/agents/{agent_id}/invoke/async
```

### Multi-Agent Workflow

```bash
curl -X POST -H "x-api-key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "input": {
      "text": "Process this sub-task"
    },
    "parent_execution_id": "parent-task-uuid",
    "triggering_agent_id": "coordinator-agent-uuid",
    "payload_extension": {
      "workflow_id": "WF-2025-001",
      "step": 2,
      "total_steps": 5
    }
  }' \
  https://api.xpander.ai/v1/agents/{agent_id}/invoke/async
```

### Advanced: Full Feature Set

```bash
curl -X POST -H "x-api-key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "input": {
      "text": "Research AI trends and create a presentation",
      "files": [],
      "user": {
        "id": "analyst-001",
        "email": "analyst@company.com"
      }
    },
    "output_format": "markdown",
    "title": "AI Trends Research",
    "additional_context": "Target audience: C-level executives. Professional tone.",
    "expected_output": "10-slide presentation outline with key points",
    "payload_extension": {
      "project_id": "PROJ-2025-042",
      "priority": "high",
      "deadline": "2025-11-15"
    },
    "mcp_servers": [
      {
        "name": "web-search",
        "config": {"provider": "google"}
      }
    ],
    "source": "research-portal"
  }' \
  https://api.xpander.ai/v1/agents/{agent_id}/invoke/async
```

### Multi-Turn Conversation (Async)

```bash
# First message - creates a new conversation thread
curl -X POST -H "x-api-key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "input": {
      "text": "My name is Bob and I work in sales"
    },
    "id": "thread-async-456"
  }' \
  https://api.xpander.ai/v1/agents/{agent_id}/invoke/async

# Poll for completion using the task ID, then send follow-up
curl -X POST -H "x-api-key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "input": {
      "text": "What is my name and what department do I work in?"
    },
    "id": "thread-async-456"
  }' \
  https://api.xpander.ai/v1/agents/{agent_id}/invoke/async
# Agent will remember: "Your name is Bob and you work in sales"

# Another follow-up in the same conversation thread
curl -X POST -H "x-api-key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "input": {
      "text": "How many messages have I sent you in this thread?"
    },
    "id": "thread-async-456"
  }' \
  https://api.xpander.ai/v1/agents/{agent_id}/invoke/async
# Agent will respond based on full conversation history
```

## Example Response

```json
{
  "id": "60ce6693-9c4d-45a0-a675-76cd8cbefbac",
  "agent_id": "e9aaf26b-5e8b-42ce-9a96-b32acd9136cb",
  "organization_id": "91fbe9bc-35b3-41e8-b59d-922fb5a0f031",
  "input": {
    "text": "What is 5+5?",
    "files": [],
    "user": null
  },
  "status": "pending",
  "internal_status": null,
  "last_executed_node_id": null,
  "agent_version": null,
  "created_at": "2025-11-06T21:08:55.503495Z",
  "started_at": null,
  "paused_at": null,
  "finished_at": null,
  "result": null,
  "parent_execution": null,
  "sub_executions": [],
  "finished_sub_executions": [],
  "is_manually_stopped": false,
  "payload_extension": null,
  "hitl_request": null,
  "pending_eca_request": null,
  "source": "api",
  "worker_id": null,
  "additional_context": null,
  "expected_output": null,
  "output_format": "text",
  "output_schema": null,
  "events_streaming": false,
  "used_mutating_tools": false,
  "is_continuous": false,
  "mcp_servers": [],
  "triggering_agent_id": null,
  "title": null
}
```

## Polling for Results

Use the task ID with the [Get Task](/API reference/v1/tasks/get-task) endpoint to check status and retrieve results:

```bash
# Poll for results (repeat until status is "completed")
curl -H "x-api-key: YOUR_API_KEY" \
  https://api.xpander.ai/v1/tasks/{task_id}
```

## Notes

- **Multi-Turn Conversations**: Use the same `id` parameter across requests to maintain conversation context. The agent will remember all previous messages in the thread.
- Each task returns immediately with a task ID - poll the `/tasks/{task_id}` endpoint to check completion status
- For multi-turn conversations, wait for each task to complete before sending the next message to ensure proper context

## See Also

- [Invoke Agent (Sync)](/API reference/v1/agents/invoke-sync) - For quick tasks that complete in under 30 seconds
- [Invoke Agent (Stream)](/API reference/v1/agents/invoke-stream) - For real-time streaming responses
- [Get Task](/API reference/v1/tasks/get-task) - Poll for task status and retrieve results
- [Get Task Thread](/API reference/v1/tasks/get-thread) - View complete conversation history for a thread
- [List Tasks](/API reference/v1/tasks/list-tasks) - Query and filter task history
- [Get Agent Tasks](/API reference/v1/agents/list-agents) - Get all tasks for a specific agent
- [Agent Memory](/user-guide/backend-configuration/agent-memory) - Configure how agents store and recall conversation history
