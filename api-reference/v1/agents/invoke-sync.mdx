---
title: "Invoke Agent (Sync)"
openapi: "POST /v1/agents/{agent_id}/invoke"
description: "Invoke an AI agent and wait for task completion. Returns the final result."
---

Execute an agent task synchronously and wait for completion. This endpoint blocks until the task finishes and returns the complete result. Best for tasks expected to complete within 30 seconds.

## Path Parameters

<ParamField path="agent_id" type="string" required>
  Unique identifier of the agent to invoke (UUID format)
</ParamField>

## Request Body

<ParamField body="input" type="object" required>
  Agent execution input containing the task details
  <Expandable title="Input Object">
    <ParamField body="text" type="string">
      The message or task to send to the agent. Either `text` or `files` must be provided.
    </ParamField>
    <ParamField body="files" type="array">
      Array of file URLs or file identifiers to process. Supports documents (PDF, DOCX, TXT), images (JPG, PNG), spreadsheets (CSV, XLSX), and more.
      
      **Example**: `["https://example.com/doc.pdf", "file-id-12345"]`
    </ParamField>
    <ParamField body="user" type="object">
      User information for personalization and audit trail
      <Expandable title="User Object">
        <ParamField body="id" type="string">
          Unique user identifier
        </ParamField>
        <ParamField body="first_name" type="string">
          User's first name
        </ParamField>
        <ParamField body="last_name" type="string">
          User's last name
        </ParamField>
        <ParamField body="email" type="string" required>
          User's email address (required if user object is provided)
        </ParamField>
        <ParamField body="additional_attributes" type="object">
          Custom user metadata (e.g., `{"customer_tier": "premium", "preferences": {...}}`)
        </ParamField>
      </Expandable>
    </ParamField>
  </Expandable>
</ParamField>

<ParamField body="output_format" type="string">
  Desired output format. Valid values: `text` | `json` | `markdown`
  
  **Default**: `text`
  
  - `text`: Plain text response
  - `json`: Structured JSON output (use with `output_schema` for validation)
  - `markdown`: Formatted markdown response
</ParamField>

<ParamField body="output_schema" type="object">
  JSON Schema to validate and structure the agent's output. When provided with `output_format: "json"`, the agent will return data conforming to this schema.
  
  **Example**:
  ```json
  {
    "type": "object",
    "required": ["name", "email"],
    "properties": {
      "name": {"type": "string"},
      "email": {"type": "string", "format": "email"}
    }
  }
  ```
</ParamField>

<ParamField body="additional_context" type="string">
  Additional context to guide the agent's behavior. Use this to specify tone, audience, constraints, or background information.
  
  **Example**: `"This is for executive leadership. Use professional tone and focus on business impact."`
</ParamField>

<ParamField body="expected_output" type="string">
  Description of the expected output format, length, or structure. Helps guide the agent to produce the desired result.
  
  **Example**: `"A 500-word summary with 3 key recommendations and supporting data."`
</ParamField>

<ParamField body="title" type="string">
  Human-readable title for the task. Useful for identification and organization in task lists.
  
  **Example**: `"Q4 Sales Analysis"`
</ParamField>

<ParamField body="parent_execution_id" type="string">
  UUID of the parent task if this is a sub-task. Used for multi-agent workflows and task hierarchies.
  
  **Example**: `"550e8400-e29b-41d4-a716-446655440000"`
</ParamField>

<ParamField body="triggering_agent_id" type="string">
  UUID of the agent that triggered this task. Used for tracking agent-to-agent delegation.
  
  **Example**: `"7c9e6679-7425-40de-944b-e07fc1f90ae7"`
</ParamField>

<ParamField body="payload_extension" type="object">
  Custom metadata to attach to the task. Any valid JSON object. Useful for tracking, routing, or application-specific data.
  
  **Example**:
  ```json
  {
    "request_id": "REQ-2025-001",
    "priority": "high",
    "department": "sales",
    "tags": ["urgent", "vip-customer"]
  }
  ```
</ParamField>

<ParamField body="mcp_servers" type="array">
  Array of Model Context Protocol (MCP) server configurations to use during execution. Enables integration with external tools and services.
  
  **Example**:
  ```json
  [
    {
      "name": "web-search",
      "config": {"provider": "google", "max_results": 10}
    }
  ]
  ```
</ParamField>

<ParamField body="source" type="string">
  Identifier for the source system or application that created this task. Useful for analytics and debugging.
  
  **Example**: `"mobile-app"` | `"web-dashboard"` | `"api-integration"`
</ParamField>

<ParamField body="id" type="string">
  **Thread ID** for conversation context. This ID is critical for multi-turn conversations:
  
  - **If not provided**: A UUID will be automatically generated (recommended for single-turn requests)
  - **First message in conversation**: Provide a unique UUID and save it for subsequent messages
  - **Follow-up messages**: Use the same `id` from the first request to maintain conversation history
  - The agent will remember all previous messages in the thread when you reuse the same ID
  
  **Example**: `"a37db9a1-e483-4544-9136-b32120ae8c81"`
  
  <Info>
    **Multi-Turn Conversations**: To enable the agent to remember previous messages, always use the same `id` for all requests in a conversation thread. Each unique `id` represents a separate conversation session. The response will include the same `id` (whether you provided it or it was auto-generated).
  </Info>
</ParamField>

## Response

Returns a complete `AgentExecution` object with the final result:

<ResponseField name="id" type="string">
  Unique identifier for the created task (UUID) - this is the thread ID if you provided one
</ResponseField>

<ResponseField name="agent_id" type="string">
  UUID of the agent that executed this task
</ResponseField>

<ResponseField name="organization_id" type="string">
  UUID of the organization
</ResponseField>

<ResponseField name="status" type="string">
  Task execution status: `completed`, `failed`, `error`
</ResponseField>

<ResponseField name="input" type="object">
  The input object that was provided
</ResponseField>

<ResponseField name="result" type="string">
  Task execution result content
</ResponseField>

<ResponseField name="created_at" type="string">
  ISO 8601 timestamp of when the task was created
</ResponseField>

<ResponseField name="started_at" type="string">
  ISO 8601 timestamp of when execution began (may be null)
</ResponseField>

<ResponseField name="finished_at" type="string">
  ISO 8601 timestamp of when the task finished
</ResponseField>

<ResponseField name="output_format" type="string">
  The output format specified in the request
</ResponseField>

<ResponseField name="output_schema" type="object">
  The output schema if provided in the request
</ResponseField>

<ResponseField name="title" type="string">
  The task title if provided
</ResponseField>

<ResponseField name="source" type="string">
  The source identifier (e.g., "api")
</ResponseField>

<ResponseField name="events_streaming" type="boolean">
  Whether event streaming was enabled
</ResponseField>

<ResponseField name="payload_extension" type="object">
  Custom metadata attached to the task
</ResponseField>

<ResponseField name="parent_execution" type="object">
  Parent task information if this is a sub-task
</ResponseField>

<ResponseField name="sub_executions" type="array">
  Array of sub-task executions spawned by this task
</ResponseField>

<ResponseField name="triggering_agent_id" type="string">
  UUID of the agent that triggered this task (if delegated)
</ResponseField>

## Example Requests

### Basic Request

```bash
curl -X POST -H "x-api-key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "input": {
      "text": "What is 2+2?"
    }
  }' \
  https://api.xpander.ai/v1/agents/{agent_id}/invoke
```

### Structured JSON Output

```bash
curl -X POST -H "x-api-key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "input": {
      "text": "Parse this address: 123 Main St, San Francisco, CA 94102"
    },
    "output_format": "json",
    "output_schema": {
      "type": "object",
      "required": ["street", "city", "state", "zip"],
      "properties": {
        "street": {"type": "string"},
        "city": {"type": "string"},
        "state": {"type": "string"},
        "zip": {"type": "string"}
      }
    }
  }' \
  https://api.xpander.ai/v1/agents/{agent_id}/invoke
```

### With User Context and Custom Metadata

```bash
curl -X POST -H "x-api-key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "input": {
      "text": "Summarize my recent activity",
      "user": {
        "id": "user-456",
        "first_name": "John",
        "last_name": "Doe",
        "email": "john.doe@company.com",
        "additional_attributes": {
          "account_type": "enterprise",
          "timezone": "America/Los_Angeles"
        }
      }
    },
    "title": "User Activity Summary",
    "payload_extension": {
      "session_id": "sess-789",
      "source_page": "dashboard"
    }
  }' \
  https://api.xpander.ai/v1/agents/{agent_id}/invoke
```

### Markdown Output with Context

```bash
curl -X POST -H "x-api-key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "input": {
      "text": "Write a tutorial on REST APIs"
    },
    "output_format": "markdown",
    "additional_context": "Target audience: beginner developers. Include code examples.",
    "expected_output": "A 1000-word tutorial with introduction, examples, and best practices"
  }' \
  https://api.xpander.ai/v1/agents/{agent_id}/invoke
```

### Multi-Turn Conversation

```bash
# First message - creates a new conversation thread
curl -X POST -H "x-api-key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "input": {
      "text": "My name is Alice and I like Python programming"
    },
    "id": "conversation-thread-123"
  }' \
  https://api.xpander.ai/v1/agents/{agent_id}/invoke

# Follow-up message - reuses the same ID to maintain context
curl -X POST -H "x-api-key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "input": {
      "text": "What is my name and what do I like?"
    },
    "id": "conversation-thread-123"
  }' \
  https://api.xpander.ai/v1/agents/{agent_id}/invoke
# Agent will respond: "Your name is Alice and you like Python programming"

# Another follow-up in the same thread
curl -X POST -H "x-api-key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "input": {
      "text": "How many messages have I sent in this thread?"
    },
    "id": "conversation-thread-123"
  }' \
  https://api.xpander.ai/v1/agents/{agent_id}/invoke
# Agent will respond based on the full conversation history
```

## Example Response

```json
{
  "id": "test-thread-20251112",
  "agent_id": "efada57d-3d0d-44d1-b64c-e2c2d0dfcc42",
  "organization_id": "91fbe9bc-35b3-41e8-b59d-922fb5a0f031",
  "input": {
    "text": "What is 2+2?",
    "files": [],
    "user": null
  },
  "status": "completed",
  "internal_status": null,
  "last_executed_node_id": null,
  "agent_version": null,
  "created_at": "2025-11-12T06:17:20.631941Z",
  "started_at": null,
  "paused_at": null,
  "finished_at": "2025-11-12T06:17:26.869452Z",
  "result": "2+2 equals 4",
  "parent_execution": null,
  "sub_executions": [],
  "finished_sub_executions": [],
  "is_manually_stopped": false,
  "payload_extension": null,
  "hitl_request": null,
  "pending_eca_request": null,
  "source": "api",
  "worker_id": null,
  "additional_context": null,
  "expected_output": null,
  "output_format": "text",
  "output_schema": null,
  "events_streaming": false,
  "used_mutating_tools": false,
  "is_continuous": false,
  "mcp_servers": [],
  "triggering_agent_id": null,
  "title": null
}
```

## Notes

- This endpoint waits for task completion before returning
- Recommended timeout: 30-60 seconds
- For long-running tasks, use [Invoke Agent (Async)](/API reference/v1/agents/invoke-async) instead
- The agent must have `deployment_type: serverless` or be a running container
- **Multi-Turn Conversations**: Use the same `id` parameter across requests to maintain conversation context. The agent will remember all previous messages in the thread.

## See Also

- [Invoke Agent (Async)](/API reference/v1/agents/invoke-async) - For long-running tasks that don't need immediate results
- [Invoke Agent (Stream)](/API reference/v1/agents/invoke-stream) - For real-time streaming responses
- [Get Task](/API reference/v1/tasks/get-task) - Retrieve task details and results
- [Get Task Thread](/API reference/v1/tasks/get-thread) - View complete conversation history for a thread
- [List Tasks](/API reference/v1/tasks/list-tasks) - Query and filter task history
- [Agent Memory](/user-guide/backend-configuration/agent-memory) - Configure how agents store and recall conversation history
